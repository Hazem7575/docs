---
title: 'Zatca Package'
description: 'ZATCA (Fatoora) e-invoicing implementation for Saudi Arabia'
---

## Setup your package
Learn how to install and configure the Zatca package for your Laravel application.

### Installation and Configuration
<AccordionGroup>
  <Accordion icon="terminal" title="Install via Composer">
    Install the package using Composer with the following command:
    ```bash
    composer require hazem/zatca
    ```
  </Accordion>
  <Accordion icon="gear" title="Publish Configuration">
    Publish the configuration files and migrations:
    ```bash
    php artisan vendor:publish --provider="Hazem\Zatca\ZatcaServiceProvider"
    ```
    Then run the migrations:
    ```bash
    php artisan migrate
    ```
  </Accordion>
  <Accordion icon="file" title="Environment Setup">
    Configure your environment variables in `.env`:
    ```env
    ZATCA_LIVE=false
    ZATCA_VAT_NO=
    ZATCA_COMPANY_NAME=
    # Additional settings as needed
    ```
  </Accordion>
</AccordionGroup>

### Basic Implementation
<AccordionGroup>
  <Accordion icon="code" title="Add Required Traits">
    Add the necessary traits to your model:
    ```php
    use Hazem\Zatca\Traits\HasZatcaDevice;
    use Hazem\Zatca\Traits\HasZatcaInvoice;

    class Order extends Model
    {
        use HasZatcaDevice, HasZatcaInvoice;
    }
    ```
  </Accordion>
  <Accordion icon="server" title="Register Device">
    Register a new ZATCA device:
    ```php
    $order = Order::find(1);
    $device = $order->registerZatcaDevice($otp, [
        'vat_no' => '123456789',
        'company_name' => 'My Company',
        // Additional configuration
    ]);
    ```
  </Accordion>
</AccordionGroup>

## Working with Invoices

### Submit Invoices
<CardGroup>
  <Card title="Basic Submission" icon="paper-plane">
    Submit an invoice using the basic method:
    ```php
    $order = Order::find(1);
    $result = $order->submitToZatca();
    ```
  </Card>
  <Card title="Custom Data" icon="pen-to-square">
    Submit with custom invoice data:
    ```php
    $result = $order->submitToZatca([
        'invoice_number' => 'INV-001',
        'buyer_name' => 'Customer Name',
        'buyer_vat' => '1234567890',
        'total_amount' => 100,
        'vat_amount' => 15,
        'items' => [
            [
                'name' => 'Product 1',
                'quantity' => 1,
                'price' => 100,
                'vat' => 15
            ]
        ]
    ]);
    ```
  </Card>
</CardGroup>

### Custom Data Handling
<Note>
You can override the default methods in your model for custom data preparation:
</Note>

```php
class Order extends Model
{
    use HasZatcaInvoice;

    protected function prepareZatcaInvoiceData()
    {
        return [
            'invoice_number' => $this->custom_number,
            'buyer_name' => $this->client->name,
            // Additional custom data
        ];
    }

    protected function prepareZatcaItems()
    {
        return $this->orderItems->map(function($item) {
            return [
                'name' => $item->product->name,
                'quantity' => $item->quantity,
                'price' => $item->unit_price,
                'vat' => $item->tax_amount
            ];
        })->toArray();
    }
}
```

## Status Management

### Verify Invoice Status
<CardGroup>
  <Card title="Check Submission" icon="check">
    ```php
    if ($order->isSubmittedToZatca()) {
        // Successfully submitted
    }
    ```
  </Card>
  <Card title="Get Status" icon="circle-info">
    ```php
    $status = $order->getZatcaStatus();
    ```
  </Card>
  <Card title="Check Errors" icon="triangle-exclamation">
    ```php
    if ($order->hasZatcaErrors()) {
        $errors = $order->getZatcaErrors();
    }
    ```
  </Card>
</CardGroup>

## Database Structure

### Tables Schema
<AccordionGroup>
  <Accordion icon="table" title="hazem_devices_zatca">
    Stores registered device information:
    
    - `id` - Serial identifier
    - `deviceable_type` - Associated model type
    - `deviceable_id` - Associated model ID
    - `request_id` - ZATCA request ID
    - `disposition_message` - Status message
    - `binary_security_token` - Security token
    - `secret` - Secret key
    - `errors` - Errors (JSON)
    - `private_key` - Private key
    - `public_key` - Public key
    - `csr_content` - CSR content
  </Accordion>
  <Accordion icon="table" title="hazem_orders_zatca">
    Stores submitted invoice information:
    
    - `id` - Serial identifier
    - `orderable_type` - Associated model type
    - `orderable_id` - Associated model ID
    - `invoice_number` - Invoice number
    - `uuid` - Unique identifier
    - `invoice_hash` - Invoice hash
    - `signed_invoice_xml` - Signed XML
    - `status` - Invoice status
    - `is_reported` - Reporting status
    - `is_cleared` - Clearance status
    - `warnings` - Warnings (JSON)
    - `errors` - Errors (JSON)
    - `response` - Complete response (JSON)
    - `submitted_at` - Submission timestamp
  </Accordion>
</AccordionGroup>

## Available Methods

### Trait Methods
<CardGroup>
  <Card title="HasZatcaDevice Trait" icon="microchip">
    - `zatcaDevice()` - ZATCA device relationship
    - `registerZatcaDevice()` - Register new device
    - `hasZatcaDevice()` - Check device existence
    - `getLatestZatcaDevice()` - Get latest device
  </Card>
  <Card title="HasZatcaInvoice Trait" icon="file-invoice">
    - `zatcaOrders()` - ZATCA orders relationship
    - `latestZatcaOrder()` - Get latest order
    - `submitToZatca()` - Submit invoice
    - `isSubmittedToZatca()` - Check submission status
    - `getZatcaStatus()` - Get invoice status
    - `hasZatcaErrors()` - Check for errors
    - `getZatcaErrors()` - Get error details
  </Card>
</CardGroup>

## Contributing and License

<Note>
  Contributions are welcome! Please submit pull requests to our GitHub repository.
</Note>

Licensed under the MIT License.